var L=Object.defineProperty;var h=(t,e,o)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var a=(t,e,o)=>(h(t,typeof e!="symbol"?e+"":e,o),o);import{s as i,c as d}from"./storage-0924aca3.js";import{o as g,c as s,s as I,U as _,I as f}from"./firebase-7a37cf60.js";import{b}from"./youtube-91385786.js";const k=()=>{g(s,async t=>{t?await i("user",{uid:t.uid,displayName:(t==null?void 0:t.displayName)??"Guest",photoURL:(t==null?void 0:t.photoURL)??"https://glasp.co/images/icons/userphoto.png"}):await d("user")})},y=async({token:t})=>{try{const e=await I(s,t),o=(e==null?void 0:e.user)??null;await i("user",{uid:o.uid,displayName:(o==null?void 0:o.displayName)??"Guest",photoURL:(o==null?void 0:o.photoURL)??"https://glasp.co/images/icons/userphoto.png"})}catch{return}};class C{constructor(){a(this,"prompt","")}getInstance(){return this}}let r=new C;const N=()=>{chrome.runtime.onMessage.addListener((t,e,o)=>{if(!t.action)return!0;switch(t.action){case"openOptions":{const n=chrome.runtime.getURL("src/options/index.html");chrome.tabs.create({url:n}),o();break}case"get_prompt":{o({prompt:r.prompt}),r.prompt="";break}case"set_prompt":{r.prompt=t.prompt,o();break}case"summarize_on_page":{const{prompt:n,title:c,thumbnail:p,url:m,retry:l}=t;return b({prompt:n,title:c,thumbnail:p,url:m,retry:l}).then(u=>{o(u)}),!0}case"chrome_ext_signin_token":{const n=t.data;return y({token:n}).then(()=>{o()}),!0}}})},R=()=>{chrome.runtime.onInstalled.addListener(function(t){t.reason==="install"?chrome.tabs.create({url:f}):t.reason})};chrome.runtime.setUninstallURL(_);function w(){chrome.action.onClicked.addListener(function(){const t=chrome.runtime.getURL("src/options/index.html");chrome.tabs.create({url:t})})}k();N();R();w();
